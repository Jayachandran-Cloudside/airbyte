version: "4.3.0"
definitions:
  yotpo_extractor:
    type: DpathExtractor
    field_path:
      - "{{ parameters['extractorPath'] }}"
  yotpo_stream_requester:
    type: HttpRequester
    url_base: "{{ parameters['requesterUrl'] }}"
    http_method: "GET"
    request_parameters:
      utoken: "{{ config['access_token'] }}"
  yotpo_paginator:
    type: "DefaultPaginator"
    page_size_option:
      type: "RequestOption"
      inject_into: "request_parameter"
      field_name: "count"
    pagination_strategy:
      type: "OffsetIncrement"
      page_size: 1
    page_token_option:
      type: "RequestOption"
      field_name: "page"
      inject_into: "request_parameter"
  yotpo_base:
    type: DeclarativeStream
    retriever:
      type: SimpleRetriever
      record_selector:
        type: RecordSelector
        extractor:
          type: DpathExtractor
          field_path:
            - "{{ parameters['extractorPath'] }}"
      paginator:
        type: "DefaultPaginator"
        page_size_option:
          type: "RequestOption"
          inject_into: "request_parameter"
          field_name: "count"
        pagination_strategy:
          type: "OffsetIncrement"
          page_size: 1
        page_token_option:
          type: "RequestOption"
          field_name: "page"
          inject_into: "request_parameter"
      requester:
        type: HttpRequester
        url_base: "{{ parameters['requesterUrl'] }}"
        http_method: "GET"
        request_parameters:
          utoken: "{{ config['access_token'] }}"
  yotpo_base_without_pagination:
    type: DeclarativeStream
    retriever:
      type: SimpleRetriever
      record_selector:
        type: RecordSelector
        extractor:
          type: DpathExtractor
          field_path:
            - "{{ parameters['extractorPath'] }}"
      paginator:
        type: NoPagination
      requester:
        type: HttpRequester
        url_base: "{{ parameters['requesterUrl'] }}"
        http_method: "GET"
        request_parameters:
          utoken: "{{ config['access_token'] }}"
  reviews_stream:
    type: DeclarativeStream
    retriever:
      type: SimpleRetriever
      record_selector:
        type: RecordSelector
        extractor:
          type: DpathExtractor
          field_path:
            - "{{ parameters['extractorPath'] }}"
      paginator:
        type: "DefaultPaginator"
        page_size_option:
          type: "RequestOption"
          inject_into: "request_parameter"
          field_name: "count"
        pagination_strategy:
          type: "OffsetIncrement"
          page_size: 1
        page_token_option:
          type: "RequestOption"
          field_name: "page"
          inject_into: "request_parameter"
      requester:
        type: HttpRequester
        url_base: "{{ parameters['requesterUrl'] }}"
        http_method: "GET"
        request_parameters:
          utoken: "{{ config['access_token'] }}"
    incremental_sync:
      type: DatetimeBasedCursor
      cursor_field: "created_at"
      datetime_format: "%Y-%m-%dT%H:%M:%S.%f%z"
      cursor_granularity: "PT0.000001S"
      lookback_window: "P31D"
      start_datetime:
        datetime: "{{ config['start_date'] }}"
        datetime_format: "%Y-%m-%dT%H:%M:%S.%f%z"
      end_datetime:
        datetime: "{{ today_utc() }}"
        datetime_format: "%Y-%m-%d"
      step: "P1M"
    name: "reviews"
    primary_key: "id"
    schema_loader:
      type: InlineSchemaLoader
      schema:
        $schema: http://json-schema.org/draft-07/schema#
        title: Reviews Schema
        additionalProperties: true
        type: object
        properties:
          id:
            type:
              - "null"
              - number
          title:
            type:
              - "null"
              - string
          incentive_type:
            type:
              - "null"
              - string
          content:
            type:
              - "null"
              - string
          score:
            type:
              - "null"
              - number
          votes_up:
            type:
              - "null"
              - number
          votes_down:
            type:
              - "null"
              - number
          created_at:
            type:
              - "null"
              - string
            format: date-time
          updated_at:
            type:
              - "null"
              - string
            format: date-time
          sentiment:
            type:
              - "null"
              - number
          sku:
            type:
              - "null"
              - string
          name:
            type:
              - "null"
              - string
          email:
            type:
              - "null"
              - string
          reviewer_type:
            type:
              - "null"
              - string
          deleted:
            type:
              - "null"
              - boolean
          archived:
            type:
              - "null"
              - boolean
          escalated:
            type:
              - "null"
              - boolean
          is_incentivized:
            type:
              - "null"
              - boolean
  email_analytics_stream:
    type: DeclarativeStream
    retriever:
      type: SimpleRetriever
      record_selector:
        type: RecordSelector
        extractor:
          type: DpathExtractor
          field_path:
            - "{{ parameters['extractorPath'] }}"
      paginator:
        type: NoPagination
      requester:
        type: HttpRequester
        url_base: "{{ parameters['requesterUrl'] }}"
        http_method: "GET"
        request_parameters:
          utoken: "{{ config['access_token'] }}"
    name: "email_analytics"
    schema_loader:
      type: InlineSchemaLoader
      schema:
        $schema: http://json-schema.org/draft-07/schema#
        title: Email Analytics
        additionalProperties: true
        type: object
        properties:
          since:
            type:
              - "null"
              - string
          until:
            type:
              - "null"
              - string
          values:
            type:
              - "null"
              - object
            properties:
              done:
                type:
                  - "null"
                  - boolean
  raw_data_stream:
    type: DeclarativeStream
    retriever:
      type: SimpleRetriever
      record_selector:
        type: RecordSelector
        extractor:
          type: DpathExtractor
          field_path:
            - "{{ parameters['extractorPath'] }}"
      paginator:
        type: NoPagination
      requester:
        type: HttpRequester
        url_base: "{{ parameters['requesterUrl'] }}"
        http_method: "GET"
        request_parameters:
          utoken: "{{ config['access_token'] }}"
    name: "raw_data"
    schema_loader:
      type: InlineSchemaLoader
      schema:
        $schema: http://json-schema.org/draft-07/schema#
        title: Raw Data Schema
        additionalProperties: true
        type: object
        properties:
          email_address:
            type:
              - "null"
              - string
          order_id:
            type:
              - "null"
              - string
          order_timestamp:
            type:
              - "null"
              - string
          product_id:
            type:
              - "null"
              - string
          sku:
            type:
              - "null"
              - number
          email_type:
            type:
              - "null"
              - string
          reminder_num:
            type:
              - "null"
              - number
          trr_bundle_id:
            type:
              - "null"
              - string
          trr_bundle_subject:
            type:
              - "null"
              - string
          review_type:
            type:
              - "null"
              - string
          coupon_code:
            type:
              - "null"
              - number
          email_sent_timestamp:
            type:
              - "null"
              - string
          opened_timestamp:
            type:
              - "null"
              - string
          clicked_through_timestamp:
            type:
              - "null"
              - string
          content_creation_timestamp:
            type:
              - "null"
              - string
          platform:
            type:
              - "null"
              - string
          invalid_address_timestamp:
            type:
              - "null"
              - string
          failed_timestamp:
            type:
              - "null"
              - string
          unsubscribed_timestamp:
            type:
              - "null"
              - string
          marked_spam_timestamp:
            type:
              - "null"
              - string
          arrived_early_timestamp:
            type:
              - "null"
              - string
  unsubscribers_stream:
    type: DeclarativeStream
    retriever:
      type: SimpleRetriever
      record_selector:
        type: RecordSelector
        extractor:
          type: DpathExtractor
          field_path:
            - "{{ parameters['extractorPath'] }}"
      paginator:
        type: "DefaultPaginator"
        page_size_option:
          type: "RequestOption"
          inject_into: "request_parameter"
          field_name: "count"
        pagination_strategy:
          type: "OffsetIncrement"
          page_size: 1
        page_token_option:
          type: "RequestOption"
          field_name: "page"
          inject_into: "request_parameter"
      requester:
        type: HttpRequester
        url_base: "{{ parameters['requesterUrl'] }}"
        http_method: "GET"
        request_parameters:
          utoken: "{{ config['access_token'] }}"
    name: "unsubscribers"
    schema_loader:
      type: InlineSchemaLoader
      schema:
        $schema: http://json-schema.org/draft-07/schema#
        title: Unsubscribers Schema
        additionalProperties: true
        type: object
        properties:
          id:
            type:
              - "null"
              - number
          user_email:
            type:
              - "null"
              - string
          email_type_id:
            type:
              - "null"
              - number
          unsubscribed_by_name:
            type:
              - "null"
              - string
  webhook_events_stream:
    type: DeclarativeStream
    retriever:
      type: SimpleRetriever
      record_selector:
        type: RecordSelector
        extractor:
          type: DpathExtractor
          field_path:
            - "{{ parameters['extractorPath'] }}"
      paginator:
        type: NoPagination
      requester:
        type: HttpRequester
        url_base: "{{ parameters['requesterUrl'] }}"
        http_method: "GET"
        request_parameters:
          utoken: "{{ config['access_token'] }}"
    name: "webhook_events"
    schema_loader:
      type: InlineSchemaLoader
      schema:
        $schema: http://json-schema.org/draft-07/schema#
        title: Webhook events Schema
        additionalProperties: true
        type: object
        properties:
          name:
            type:
              - "null"
              - string
          description:
            type:
              - "null"
              - string
  webhooks_stream:
    type: DeclarativeStream
    retriever:
      type: SimpleRetriever
      record_selector:
        type: RecordSelector
        extractor:
          type: DpathExtractor
          field_path:
            - "{{ parameters['extractorPath'] }}"
      paginator:
        type: NoPagination
      requester:
        type: HttpRequester
        url_base: "{{ parameters['requesterUrl'] }}"
        http_method: "GET"
        request_parameters:
          utoken: "{{ config['access_token'] }}"
    name: "webhooks"
    schema_loader:
      type: InlineSchemaLoader
      schema:
        $schema: http://json-schema.org/draft-07/schema#
        title: Webhooks Schema
        additionalProperties: true
        type:
          - "null"
          - object
        properties:
          id:
            type:
              - "null"
              - number
          webhook_event_id:
            type:
              - "null"
              - number
          webhook_event_name:
            type:
              - "null"
              - string
          url:
            type:
              - "null"
              - string
          version:
            type:
              - "null"
              - number
streams:
  - type: DeclarativeStream
    retriever:
      type: SimpleRetriever
      record_selector:
        type: RecordSelector
        extractor:
          type: DpathExtractor
          field_path:
            - "{{ parameters['extractorPath'] }}"
      paginator:
        type: NoPagination
      requester:
        type: HttpRequester
        url_base: "{{ parameters['requesterUrl'] }}"
        http_method: "GET"
        request_parameters:
          utoken: "{{ config['access_token'] }}"
    name: "email_analytics"
    schema_loader:
      type: InlineSchemaLoader
      schema:
        $schema: http://json-schema.org/draft-07/schema#
        title: Email Analytics
        additionalProperties: true
        type: object
        properties:
          since:
            type:
              - "null"
              - string
          until:
            type:
              - "null"
              - string
          values:
            type:
              - "null"
              - object
            properties:
              done:
                type:
                  - "null"
                  - boolean
  - type: DeclarativeStream
    retriever:
      type: SimpleRetriever
      record_selector:
        type: RecordSelector
        extractor:
          type: DpathExtractor
          field_path:
            - "{{ parameters['extractorPath'] }}"
      paginator:
        type: NoPagination
      requester:
        type: HttpRequester
        url_base: "{{ parameters['requesterUrl'] }}"
        http_method: "GET"
        request_parameters:
          utoken: "{{ config['access_token'] }}"
    name: "raw_data"
    schema_loader:
      type: InlineSchemaLoader
      schema:
        $schema: http://json-schema.org/draft-07/schema#
        title: Raw Data Schema
        additionalProperties: true
        type: object
        properties:
          email_address:
            type:
              - "null"
              - string
          order_id:
            type:
              - "null"
              - string
          order_timestamp:
            type:
              - "null"
              - string
          product_id:
            type:
              - "null"
              - string
          sku:
            type:
              - "null"
              - number
          email_type:
            type:
              - "null"
              - string
          reminder_num:
            type:
              - "null"
              - number
          trr_bundle_id:
            type:
              - "null"
              - string
          trr_bundle_subject:
            type:
              - "null"
              - string
          review_type:
            type:
              - "null"
              - string
          coupon_code:
            type:
              - "null"
              - number
          email_sent_timestamp:
            type:
              - "null"
              - string
          opened_timestamp:
            type:
              - "null"
              - string
          clicked_through_timestamp:
            type:
              - "null"
              - string
          content_creation_timestamp:
            type:
              - "null"
              - string
          platform:
            type:
              - "null"
              - string
          invalid_address_timestamp:
            type:
              - "null"
              - string
          failed_timestamp:
            type:
              - "null"
              - string
          unsubscribed_timestamp:
            type:
              - "null"
              - string
          marked_spam_timestamp:
            type:
              - "null"
              - string
          arrived_early_timestamp:
            type:
              - "null"
              - string
  - type: DeclarativeStream
    retriever:
      type: SimpleRetriever
      record_selector:
        type: RecordSelector
        extractor:
          type: DpathExtractor
          field_path:
            - "{{ parameters['extractorPath'] }}"
      paginator:
        type: "DefaultPaginator"
        page_size_option:
          type: "RequestOption"
          inject_into: "request_parameter"
          field_name: "count"
        pagination_strategy:
          type: "OffsetIncrement"
          page_size: 1
        page_token_option:
          type: "RequestOption"
          field_name: "page"
          inject_into: "request_parameter"
      requester:
        type: HttpRequester
        url_base: "{{ parameters['requesterUrl'] }}"
        http_method: "GET"
        request_parameters:
          utoken: "{{ config['access_token'] }}"
    incremental_sync:
      type: DatetimeBasedCursor
      cursor_field: "created_at"
      datetime_format: "%Y-%m-%dT%H:%M:%S.%f%z"
      cursor_granularity: "PT0.000001S"
      lookback_window: "P31D"
      start_datetime:
        datetime: "{{ config['start_date'] }}"
        datetime_format: "%Y-%m-%dT%H:%M:%S.%f%z"
      end_datetime:
        datetime: "{{ today_utc() }}"
        datetime_format: "%Y-%m-%d"
      step: "P1M"
    name: "reviews"
    primary_key: "id"
    schema_loader:
      type: InlineSchemaLoader
      schema:
        $schema: http://json-schema.org/draft-07/schema#
        title: Reviews Schema
        additionalProperties: true
        type: object
        properties:
          id:
            type:
              - "null"
              - number
          title:
            type:
              - "null"
              - string
          incentive_type:
            type:
              - "null"
              - string
          content:
            type:
              - "null"
              - string
          score:
            type:
              - "null"
              - number
          votes_up:
            type:
              - "null"
              - number
          votes_down:
            type:
              - "null"
              - number
          created_at:
            type:
              - "null"
              - string
            format: date-time
          updated_at:
            type:
              - "null"
              - string
            format: date-time
          sentiment:
            type:
              - "null"
              - number
          sku:
            type:
              - "null"
              - string
          name:
            type:
              - "null"
              - string
          email:
            type:
              - "null"
              - string
          reviewer_type:
            type:
              - "null"
              - string
          deleted:
            type:
              - "null"
              - boolean
          archived:
            type:
              - "null"
              - boolean
          escalated:
            type:
              - "null"
              - boolean
          is_incentivized:
            type:
              - "null"
              - boolean
  - type: DeclarativeStream
    retriever:
      type: SimpleRetriever
      record_selector:
        type: RecordSelector
        extractor:
          type: DpathExtractor
          field_path:
            - "{{ parameters['extractorPath'] }}"
      paginator:
        type: NoPagination
      requester:
        type: HttpRequester
        url_base: "{{ parameters['requesterUrl'] }}"
        http_method: "GET"
        request_parameters:
          utoken: "{{ config['access_token'] }}"
    name: "webhooks"
    schema_loader:
      type: InlineSchemaLoader
      schema:
        $schema: http://json-schema.org/draft-07/schema#
        title: Webhooks Schema
        additionalProperties: true
        type:
          - "null"
          - object
        properties:
          id:
            type:
              - "null"
              - number
          webhook_event_id:
            type:
              - "null"
              - number
          webhook_event_name:
            type:
              - "null"
              - string
          url:
            type:
              - "null"
              - string
          version:
            type:
              - "null"
              - number
  - type: DeclarativeStream
    retriever:
      type: SimpleRetriever
      record_selector:
        type: RecordSelector
        extractor:
          type: DpathExtractor
          field_path:
            - "{{ parameters['extractorPath'] }}"
      paginator:
        type: "DefaultPaginator"
        page_size_option:
          type: "RequestOption"
          inject_into: "request_parameter"
          field_name: "count"
        pagination_strategy:
          type: "OffsetIncrement"
          page_size: 1
        page_token_option:
          type: "RequestOption"
          field_name: "page"
          inject_into: "request_parameter"
      requester:
        type: HttpRequester
        url_base: "{{ parameters['requesterUrl'] }}"
        http_method: "GET"
        request_parameters:
          utoken: "{{ config['access_token'] }}"
    name: "unsubscribers"
    schema_loader:
      type: InlineSchemaLoader
      schema:
        $schema: http://json-schema.org/draft-07/schema#
        title: Unsubscribers Schema
        additionalProperties: true
        type: object
        properties:
          id:
            type:
              - "null"
              - number
          user_email:
            type:
              - "null"
              - string
          email_type_id:
            type:
              - "null"
              - number
          unsubscribed_by_name:
            type:
              - "null"
              - string
  - type: DeclarativeStream
    retriever:
      type: SimpleRetriever
      record_selector:
        type: RecordSelector
        extractor:
          type: DpathExtractor
          field_path:
            - "{{ parameters['extractorPath'] }}"
      paginator:
        type: NoPagination
      requester:
        type: HttpRequester
        url_base: "{{ parameters['requesterUrl'] }}"
        http_method: "GET"
        request_parameters:
          utoken: "{{ config['access_token'] }}"
    name: "webhook_events"
    schema_loader:
      type: InlineSchemaLoader
      schema:
        $schema: http://json-schema.org/draft-07/schema#
        title: Webhook events Schema
        additionalProperties: true
        type: object
        properties:
          name:
            type:
              - "null"
              - string
          description:
            type:
              - "null"
              - string
check:
  type: CheckStream
  stream_names:
    - "email_analytics"
    - "raw_data"
    - "reviews"
    - "unsubscribers"
    - "webhooks"
    - "webhook_events"
spec:
  type: Spec
  documentation_url: https://docs.airbyte.com/integrations/sources/yotpo
  connection_specification:
    $schema: http://json-schema.org/draft-07/schema#
    title: Yotpo Spec
    type: object
    additionalProperties: true
    required:
      - access_token
      - app_key
      - start_date
      - email
    properties:
      access_token:
        title: Access Token
        type: string
        description:
          Access token recieved as a result of API call to https://api.yotpo.com/oauth/token
          (Ref- https://apidocs.yotpo.com/reference/yotpo-authentication)
        airbyte_secret: true
      app_key:
        title: App Key
        type: string
        description: App key found at settings (Ref- https://settings.yotpo.com/#/general_settings)
      start_date:
        title: Date-From Filter
        type: string
        description:
          Date time filter for incremental filter, Specify which date to
          extract from.
        pattern: "^[0-9]{4}-[0-9]{2}-[0-9]{2}T[0-9]{2}:[0-9]{2}:[0-9]{2}.[0-9]{3}Z$"
        examples:
          - "2022-03-01T00:00:00.000Z"
        format: "date-time"
      email:
        title: Registered email address
        type: string
        description: Email address registered with yotpo.
        default: example@gmail.com
